<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Three.js Christmas Tree Sample</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
<script>
    // 定数の設定
    const TREE_HEIGHT = 6; // ツリーの高さ
    const TREE_RADIUS = 2; // ツリーの半径
    let angle = 0; // カメラの角度

    // シーンの作成
    let scene = new THREE.Scene();

    // カメラの作成
    let camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.z = 10;

    // レンダラーの作成
    let renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // クリスマスツリーの作成
    let treeGeometry = new THREE.ConeGeometry(TREE_RADIUS, TREE_HEIGHT, 32);
    let treeMaterial = new THREE.MeshBasicMaterial({ color: 0x008000 });
    let tree = new THREE.Mesh(treeGeometry, treeMaterial);
    scene.add(tree);

    // 画像を読み込む
    let loader = new THREE.TextureLoader();
    loader.load('magicaldraw_20231029_230901.png', function(texture) {
        // 画像を5x5に分割して飾りとして使用
        for (let i = 0; i < 5; i++) {
            for (let j = 0; j < 5; j++) {
                let segmentWidth = 1 / 5;
                let segmentHeight = 1 / 5;

                // テクスチャのオフセットとリピートを設定
                texture.repeat.set(segmentWidth, segmentHeight);
                texture.offset.set(i * segmentWidth, 1 - segmentHeight - j * segmentHeight);

                // 飾りの作成
                let ornamentGeometry = new THREE.PlaneGeometry(0.5, 0.5);
                let ornamentMaterial = new THREE.MeshBasicMaterial({ map: texture, side: THREE.DoubleSide });
                let ornament = new THREE.Mesh(ornamentGeometry, ornamentMaterial);

                // 飾りの位置を設定
                let theta = Math.random() * Math.PI / 2;
                let phi = Math.random() * 2 * Math.PI;
                let heightFactor = 1 - Math.cos(theta);
                let height = TREE_HEIGHT * heightFactor;
                let radius = TREE_RADIUS * heightFactor;

                ornament.position.x = radius * Math.sin(theta) * Math.cos(phi);
                ornament.position.y = height - (TREE_HEIGHT / 2);
                ornament.position.z = radius * Math.sin(theta) * Math.sin(phi);

                scene.add(ornament);
            }
        }
    });


    // レンダリングループ
    function animate() {
        requestAnimationFrame(animate);

        // カメラの回転（円軌道を描く）
        angle += 0.01;
        camera.position.x = 10 * Math.sin(angle);
        camera.position.z = 10 * Math.cos(angle);
        camera.lookAt(scene.position); // カメラは常にシーンの中心を見る

        // シーンのレンダリング
        renderer.render(scene, camera);
    }

    animate();

</script>
</body>
</html>
